{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Your Tasks — ToDo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap 4 (same as the form page) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
        integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#0f1020;
      --glass:#ffffff1a;
      --glass-strong:#ffffff26;
      --border:#ffffff33;
      --text:#f5f7fb;
      --muted:#c8cbe0;
      --brand1:#6ee7f0;
      --brand2:#7c6cf3;
      --accent:#f6a93b;
      --ok:#22c55e;
      --danger:#ef4444;
      --soon:#f59e0b;
      --shadow:0 20px 50px rgba(0,0,0,.35);
    }

    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      color: var(--text);
      background: linear-gradient(120deg, #0e132e, #141b3a 33%, #1a2a6c 60%, #552a7a 85%);
      background-size: 200% 200%;
      animation: bgShift 14s ease-in-out infinite;
      overflow-x: hidden;
    }
    @keyframes bgShift { 0%,100%{background-position:0% 50%} 50%{background-position:100% 50%} }

    .blob { position: fixed; filter: blur(60px); opacity:.45; z-index:0; transform: translateZ(0); }
    .blob.one{ top:-10vh; left:-10vw; width:45vmax; height:45vmax; background: radial-gradient(closest-side, #6ee7f0 0%, transparent 70%); animation: float1 24s ease-in-out infinite; }
    .blob.two{ bottom:-15vh; right:-15vw; width:55vmax; height:55vmax; background: radial-gradient(closest-side, #7c6cf3 0%, transparent 70%); animation: float2 28s ease-in-out infinite; }
    .blob.three{ top:40vh; left:50vw; width:35vmax; height:35vmax; background: radial-gradient(closest-side, #f6a93b 0%, transparent 70%); animation: float3 32s ease-in-out infinite; }
    @keyframes float1 { 0%,100%{transform:translate(0,0)} 50%{transform:translate(6vw,5vh)} }
    @keyframes float2 { 0%,100%{transform:translate(0,0)} 50%{transform:translate(-5vw,-4vh)} }
    @keyframes float3 { 0%,100%{transform:translate(0,0)} 50%{transform:translate(3vw,-5vh)} }

    .navbar {
      background: linear-gradient(90deg, #11152f 0%, #171d3d 50%, #1c2250 100%);
      border-bottom: 1px solid var(--border);
      backdrop-filter: saturate(140%) blur(8px);
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
      z-index: 2;
    }
    .navbar-brand { font-weight: 800; letter-spacing: .3px; color: var(--text) !important; }

    .shell { position:relative; z-index:1; padding: 40px 16px 64px; }

    /* toolbar */
    .toolbar {
      background: linear-gradient(180deg, #ffffff10, #ffffff08);
      border: 1px solid var(--border);
      border-radius: 20px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px) saturate(140%);
      -webkit-backdrop-filter: blur(12px) saturate(140%);
      padding: 14px 16px;
      margin-bottom: 22px;
    }
    .search-input {
      width:100%; border-radius:12px; border:1px solid var(--glass-strong);
      background:#0f1228cc; color:var(--text); padding:.75rem 1rem; outline:none;
      transition: box-shadow .2s ease, border-color .2s ease, transform .08s ease;
    }
    .search-input:focus {
      border-color:#7c6cf3; box-shadow:0 0 0 6px #7c6cf333, inset 0 1px 0 rgba(255,255,255,.04); transform: translateY(-1px);
    }

    /* task card */
    .task-card {
      background: linear-gradient(180deg, #ffffff10, #ffffff08);
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      overflow: hidden;
      transition: transform .25s ease, box-shadow .3s ease;
    }
    .task-card:hover { transform: translateY(-2px); box-shadow: 0 30px 70px rgba(0,0,0,.5); }

    .task-head {
      display:flex; align-items:center; justify-content:space-between;
      padding: 14px 16px;
      border-bottom:1px solid var(--border);
      background: linear-gradient(90deg, #ffffff1a, #ffffff05);
    }
    .task-title {
      margin:0; font-weight:800; font-size:1.05rem; letter-spacing:.2px;
    }
    .task-body { padding: 1rem 1rem 1.1rem; color: var(--muted); }
    .task-desc { margin: 0; line-height: 1.55; }

    .meta {
      display:flex; align-items:center; gap:.5rem; flex-wrap:wrap;
      padding: .65rem 1rem 1rem;
    }
    .badge-soft {
      display:inline-flex; align-items:center; gap:.4rem;
      padding:.3rem .6rem; border-radius:999px; font-weight:700; font-size:.8rem;
      background:#ffffff14; border:1px solid var(--border); color:var(--text);
    }
    .badge-overdue { background:#ef444425; border-color:#ef4444aa; color:#fff; }
    .badge-soon    { background:#f59e0b25; border-color:#f59e0baa; color:#fff; }
    .badge-ok      { background:#22c55e25; border-color:#22c55eaa; color:#fff; }

    .btn-gradient {
      position: relative; display: inline-flex; align-items:center; gap:.55rem;
      border:0; color:#0b0f26; font-weight:800; letter-spacing:.3px;
      padding:.55rem .9rem; border-radius:12px;
      background: linear-gradient(135deg, var(--brand1), var(--brand2) 55%, var(--accent));
      box-shadow: 0 10px 24px rgba(124,108,243,.45);
      overflow: hidden; transition: transform .12s ease, box-shadow .2s ease;
    }
    .btn-gradient:hover{ transform: translateY(-1px); box-shadow: 0 14px 36px rgba(124,108,243,.55); }
    .btn-gradient .shine {
      content:""; position:absolute; inset:0;
      background:linear-gradient(120deg, transparent, #ffffff66, transparent);
      transform: translateX(-200%); transition: transform .8s ease; pointer-events:none;
    }
    .btn-gradient:hover .shine { transform: translateX(200%); }

    .btn-danger-soft {
      position: relative; display:inline-flex; align-items:center; gap:.45rem;
      color:#fff; background: linear-gradient(135deg, #ef4444, #d12f2f 70%); border:0;
      padding:.5rem .8rem; border-radius:12px; box-shadow: 0 10px 24px rgba(239,68,68,.35);
      transition: transform .12s ease, box-shadow .2s ease;
    }
    .btn-danger-soft:hover { transform: translateY(-1px); box-shadow: 0 14px 36px rgba(239,68,68,.5); }
    .ripple { position:absolute; border-radius:50%; transform:translate(-50%,-50%); pointer-events:none; background:#ffffff55; animation:ripple .6s ease-out forwards; }
    @keyframes ripple { from{width:0;height:0;opacity:.6} to{width:400px;height:400px;opacity:0} }

    /* empty state */
    .empty {
      text-align:center; color:#c9cde6; padding: 40px 0 10px;
    }
    .empty svg { opacity:.85; }

    .fade-in { animation: fadein .5s ease-out both; }
    @keyframes fadein { from { opacity: 0; transform: translateY(6px);} to {opacity:1; transform: translateY(0);} }
  </style>
</head>
<body>

  <div class="blob one"></div>
  <div class="blob two"></div>
  <div class="blob three"></div>

  <nav class="navbar navbar-expand-md">
    <a class="navbar-brand" href="#">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" style="margin-right:8px;vertical-align:-3px">
        <path d="M6 12l3 3 9-9" stroke="#6ee7f0" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Your Tasks
    </a>
  </nav>

  <main class="shell">
    <div class="container">
      <!-- toolbar -->
      <div class="toolbar mb-4">
        <div class="row align-items-center">
          <div class="col-md-8 mb-2 mb-md-0">
            <input id="searchBox" class="search-input" type="search" placeholder="Search tasks by title or description…">
          </div>
          <div class="col-md-4 text-md-right">
            <button id="sortDueBtn" class="btn-gradient">
              <span class="shine"></span>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M3 6h13M3 12h9M3 18h5M17 7l4 4-4 4" stroke="#0b0f26" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>Sort by due soon</span>
            </button>
          </div>
        </div>
      </div>

      <!-- grid -->
      <div id="tasksGrid" class="row">
        {% comment %} Use 'tasks' or change to your context variable name {% endcomment %}
        {% for t in task %}
          <div class="col-xl-4 col-lg-6 mb-4 task-item fade-in"
               data-title="{{ t.title|default_if_none:''|escape }}"
               data-desc="{{ t.des|default_if_none:''|striptags|escape }}"
               data-due="{{ t.due_date|date:'c' }}">
            <div class="task-card h-100">
              <div class="task-head">
                <h4 class="task-title">
                  {{ t.title }}
                </h4>
                <div class="actions">
                  <a href="{% url 'delete' t.id %}" class="btn-danger-soft btn-delete" data-title="{{ t.title|escape }}">
                    <!-- trash -->
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path d="M3 6h18M8 6v14m8-14v14M5 6l1-3h12l1 3" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Delete</span>
                  </a>
                </div>
              </div>
              <div class="task-body">
                {% if t.des %}
                  <p class="task-desc">{{ t.des }}</p>
                {% else %}
                  <p class="task-desc" style="opacity:.8"><em>No description.</em></p>
                {% endif %}
              </div>
              <div class="meta">
                <span class="badge-soft due-badge">
                  <!-- calendar -->
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                    <path d="M7 2v4m10-4v4M3 9h18M5 22h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z" stroke="#fff" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span class="due-text">
                    {% if t.due_date %}Due {{ t.due_date }}{% else %}No due date{% endif %}
                  </span>
                </span>
              </div>
            </div>
          </div>
        {% empty %}
          <div class="col-12">
            <div class="empty">
              <svg width="72" height="72" viewBox="0 0 24 24" fill="none">
                <path d="M8 7h8M6 11h12M7 15h10" stroke="#c8cbe0" stroke-width="1.8" stroke-linecap="round"/>
                <rect x="3" y="4" width="18" height="16" rx="4" stroke="#c8cbe0" stroke-width="1.6"/>
              </svg>
              <h4 class="mt-3">No tasks yet</h4>
              <p class="mb-0" style="opacity:.9">Create your first task from the Add Task page.</p>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
          integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
          crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-Fy6S3BOfjHNV1pG8eT+6d2W0r9GqQ8K/uxQYFhQ0lq2L5Fv7K4k2Jk6tBTL3e5Qv"
          crossorigin="anonymous"></script>

  <script>
    (function(){
      // search filter
      const search = document.getElementById('searchBox');
      const cards  = Array.from(document.querySelectorAll('.task-item'));
      const grid   = document.getElementById('tasksGrid');

      function filter() {
        const q = (search.value || '').toLowerCase();
        cards.forEach(c => {
          const hay = (c.dataset.title + ' ' + c.dataset.desc).toLowerCase();
          c.style.display = hay.includes(q) ? '' : 'none';
        });
      }
      search.addEventListener('input', filter);

      // sort by due soon (nulls last)
      document.getElementById('sortDueBtn').addEventListener('click', function(e){
        // ripple
        const r = document.createElement('span'); r.className='ripple';
        const rect = this.getBoundingClientRect(); r.style.left=(e.clientX-rect.left)+'px'; r.style.top=(e.clientY-rect.top)+'px';
        this.appendChild(r); setTimeout(()=>r.remove(),650);

        const items = Array.from(grid.children);
        items.sort((a,b)=>{
          const da = a.querySelector('.task-item') ? a.querySelector('.task-item').dataset.due : a.dataset.due;
          const db = b.querySelector('.task-item') ? b.querySelector('.task-item').dataset.due : b.dataset.due;
          const ta = da ? Date.parse(da) : Infinity;
          const tb = db ? Date.parse(db) : Infinity;
          return ta - tb;
        });
        items.forEach(el=>grid.appendChild(el));
      });

      // compute due badges (Overdue / Due today / Due in N days)
      const now = new Date();
      document.querySelectorAll('.task-item').forEach(item=>{
        const due = item.dataset.due ? new Date(item.dataset.due) : null;
        const badge = item.querySelector('.due-badge');
        const text  = item.querySelector('.due-text');

        if (!due || isNaN(due.getTime())) {
          badge.classList.add('badge-soft');
          text.textContent = 'No due date';
          return;
        }

        // midnight diff in days
        const dayMs = 24*60*60*1000;
        const d0 = new Date(due.getFullYear(), due.getMonth(), due.getDate());
        const n0 = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const diff = Math.round((d0 - n0) / dayMs);

        if (diff < 0) {
          badge.classList.add('badge-overdue');
          text.textContent = 'Overdue: ' + due.toDateString();
        } else if (diff === 0) {
          badge.classList.add('badge-soon');
          text.textContent = 'Due today';
        } else if (diff === 1) {
          badge.classList.add('badge-soon');
          text.textContent = 'Due tomorrow';
        } else if (diff <= 7) {
          badge.classList.add('badge-soon');
          text.textContent = 'Due in ' + diff + ' days';
        } else {
          badge.classList.add('badge-ok');
          text.textContent = 'Due ' + due.toDateString();
        }
      });

      // pretty confirm for delete
      document.querySelectorAll('.btn-delete').forEach(btn=>{
        btn.addEventListener('click', function(e){
          e.preventDefault();
          // ripple effect
          const rect = this.getBoundingClientRect();
          const r = document.createElement('span'); r.className = 'ripple';
          r.style.left = (e.clientX - rect.left) + 'px';
          r.style.top  = (e.clientY - rect.top)  + 'px';
          this.appendChild(r);
          setTimeout(()=>r.remove(), 650);

          const t = this.dataset.title || 'this task';
          if (confirm(`Delete "${t}"? This can’t be undone.`)) {
            window.location.href = this.getAttribute('href');
          }
        }, false);
      });
    })();
  </script>
</body>
</html>
